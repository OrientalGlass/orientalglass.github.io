<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="一. Frida简介 官网https://frida.re\nfrida是一款常用的hook框架,支持android/ios/windows/macos等多种平台\n">
<title>FridaStudy</title>

<link rel='canonical' href='https://example.com/p/fridastudy/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="FridaStudy">
<meta property='og:description' content="一. Frida简介 官网https://frida.re\nfrida是一款常用的hook框架,支持android/ios/windows/macos等多种平台\n">
<meta property='og:url' content='https://example.com/p/fridastudy/'>
<meta property='og:site_name' content='OrientalGlass'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-09-19T14:00:04&#43;08:00'/><meta property='article:modified_time' content='2024-09-19T14:00:04&#43;08:00'/>
<meta name="twitter:title" content="FridaStudy">
<meta name="twitter:description" content="一. Frida简介 官网https://frida.re\nfrida是一款常用的hook框架,支持android/ios/windows/macos等多种平台\n">
    <link rel="shortcut icon" href="/favicon.jpg" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_149d93b4b8d2abf8.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">OrientalGlass</a></h1>
            <h2 class="site-description">Welcome to my blog!</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/21031513'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='oriental0glass@gmail.com'
                        target="_blank"
                        title="Eamil"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" /><path d="M3 7l9 6l9 -6" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/OrientalGlass'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#一-frida简介">一. Frida简介</a></li>
    <li><a href="#二-frida环境配置">二. Frida环境配置</a>
      <ol>
        <li><a href="#frida对应关系表">frida对应关系表</a></li>
      </ol>
    </li>
    <li><a href="#三-frida常用命令">三. Frida常用命令</a>
      <ol>
        <li><a href="#frida命令参数">frida命令参数</a></li>
        <li><a href="#列出手机进程信息">列出手机进程信息</a></li>
        <li><a href="#frida注入进程">frida注入进程</a></li>
      </ol>
    </li>
    <li><a href="#四-frida-labs">四. Frida-labs</a>
      <ol>
        <li><a href="#lab1-overloadimplement-method">lab1 Overload&amp;Implement Method</a></li>
        <li><a href="#lab2-callstaticmethod">lab2 CallStaticMethod</a></li>
        <li><a href="#lab3-modifystaticvalue">lab3 ModifyStaticValue</a></li>
        <li><a href="#lab4-callinstancemethod">lab4 CallInstanceMethod</a></li>
        <li><a href="#lab5-findinstance">lab5 FindInstance</a></li>
        <li><a href="#lab6-newinstance">lab6 NewInstance</a></li>
        <li><a href="#lab7-hookconstructor">lab7 HookConstructor</a></li>
        <li><a href="#lab8-hooknaticefunc">lab8 HookNaticeFunc</a></li>
        <li><a href="#lab9-replacenativefuncretval">lab9 ReplaceNativeFuncRetval</a></li>
        <li><a href="#lab10-callnativefunc">lab10 CallNativeFunc</a></li>
        <li><a href="#lab11-patchnativeinstruction">lab11 PatchNativeInstruction</a></li>
      </ol>
    </li>
    <li><a href="#五-fridahook进阶">五. FridaHook进阶</a>
      <ol>
        <li><a href="#frida的数据结构">Frida的数据结构</a>
          <ol>
            <li><a href="#数组">数组</a></li>
          </ol>
        </li>
        <li><a href="#打印枚举操作">打印/枚举操作</a>
          <ol>
            <li><a href="#show-stacktrace">Show StackTrace</a></li>
            <li><a href="#枚举类的所有属性和方法">枚举类的所有属性和方法</a></li>
            <li><a href="#打印类实例的详细信息">打印类/实例的详细信息</a></li>
            <li><a href="#枚举所有已加载类">枚举所有已加载类</a></li>
          </ol>
        </li>
        <li><a href="#hook-java类方法">Hook Java类/方法</a>
          <ol>
            <li><a href="#hook内部类和匿名类">hook内部类和匿名类</a></li>
            <li><a href="#hook类的所有方法">hook类的所有方法</a></li>
            <li><a href="#注册java类并调用">注册java类并调用</a></li>
            <li><a href="#hook只在指定函数内生效">hook只在指定函数内生效</a></li>
            <li><a href="#定位接口抽象类的实现类">定位接口/抽象类的实现类</a></li>
          </ol>
        </li>
        <li><a href="#dex操作">Dex操作</a>
          <ol>
            <li><a href="#注入dex文件">注入dex文件</a></li>
            <li><a href="#hook动态加载的dex">hook动态加载的dex</a></li>
          </ol>
        </li>
        <li><a href="#hook-java数据结构待完善">Hook Java数据结构(待完善)</a>
          <ol>
            <li><a href="#hashmap">HashMap</a></li>
            <li><a href="#arraylist">ArrayList</a></li>
            <li><a href="#string">String</a></li>
            <li><a href="#stringfactory">StringFactory</a></li>
            <li><a href="#stringbuilder">StringBuilder</a></li>
          </ol>
        </li>
        <li><a href="#hook-标准加密库待完善">Hook 标准加密库(待完善)</a></li>
        <li><a href="#hook-android组件待完善">Hook Android组件(待完善)</a>
          <ol>
            <li><a href="#toast">Toast</a></li>
          </ol>
        </li>
        <li><a href="#native-hook">Native Hook</a></li>
        <li><a href="#其他操作">其他操作</a>
          <ol>
            <li><a href="#frida写文件">frida写文件</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#六-fridatools">六. FridaTools</a>
      <ol>
        <li><a href="#objection">Objection</a>
          <ol>
            <li><a href="#objection常用指令">objection常用指令</a></li>
            <li><a href="#repl常用指令">REPL常用指令</a></li>
          </ol>
        </li>
        <li><a href="#wallbreaker">WallBreaker</a></li>
        <li><a href="#frida-dexdump">frida-dexdump</a></li>
      </ol>
    </li>
    <li><a href="#七-frida持久化">七. Frida持久化</a>
      <ol>
        <li><a href="#frida-inject">frida-inject</a></li>
        <li><a href="#frida-gadget">frida-gadget</a></li>
      </ol>
    </li>
    <li><a href="#八-fridapython">八. FridaPython</a>
      <ol>
        <li><a href="#python连接设备">python连接设备</a>
          <ol>
            <li><a href="#attach方式">attach方式</a></li>
            <li><a href="#spawn方式">spawn方式</a></li>
            <li><a href="#连接非标准端口设备">连接非标准端口设备</a></li>
          </ol>
        </li>
        <li><a href="#frida与python交互">frida与python交互</a>
          <ol>
            <li><a href="#send">send</a></li>
            <li><a href="#recv">recv</a></li>
          </ol>
        </li>
        <li><a href="#frida-rpc">frida RPC</a></li>
        <li><a href="#frida-算法转发">frida 算法转发</a></li>
      </ol>
    </li>
    <li><a href="#九-frida逆向实战">九. Frida逆向实战</a>
      <ol>
        <li><a href="#过vpn检测">过vpn检测</a></li>
        <li><a href="#破解极简记账vip">破解极简记账VIP</a></li>
      </ol>
    </li>
    <li><a href="#十-frida-api">十. Frida API</a>
      <ol>
        <li><a href="#java-bridge">Java Bridge</a></li>
        <li><a href="#memory">Memory</a></li>
        <li><a href="#nativepointer">NativePointer</a></li>
        <li><a href="#module">Module</a></li>
        <li><a href="#debug-symbol">Debug Symbol</a>
          <ol>
            <li><a href="#debugsymbolfromaddressaddressdebugsymbolfromnamename">DebugSymbol.fromAddress(address)/DebugSymbol.fromName(name)</a></li>
          </ol>
        </li>
        <li><a href="#common-api">Common API</a></li>
        <li><a href="#table-of-api-contents">Table Of API Contents</a></li>
      </ol>
    </li>
    <li><a href="#references">References</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/android/" >
                Android
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/fridastudy/">FridaStudy</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-09-19</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="一-frida简介">一. Frida简介
</h1><p>官网https://frida.re</p>
<p>frida是一款常用的hook框架,支持android/ios/windows/macos等多种平台</p>
<p>可以实现java层和native层的函数级hook,以及native层的指令级patch等操作</p>
<p>一般在工作机上安装frida,编写脚本后使用命令行工具,启动frida并将脚本注入到靶机指定进程</p>
<p>同时需要在靶机上安装相同版本的frida-server用于监听工作机传来的操作指令</p>
<h1 id="二-frida环境配置">二. Frida环境配置
</h1><ol>
<li>
<p>安装frida</p>
<p>参考下方的frida对应关系表安装指定版本的frida和frida-tools</p>
<p>建议使用anaconda的python虚拟环境,针对不同靶机可能需要多个版本frida</p>
<p>不同版本的frida对python版本要求不同且不能共存</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pip install frida 
</span></span><span class="line"><span class="cl">pip install frida-tools
</span></span><span class="line"><span class="cl"><span class="c1">#可以通过frida=version的操作安装指定版本 </span>
</span></span><span class="line"><span class="cl"><span class="c1">#例如pip install frida=12.8.0</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>配置开发环境</p>
<p>下载WebStorm <a class="link" href="https://www.jetbrains.com/zh-cn/webstorm/download"  target="_blank" rel="noopener"
    >https://www.jetbrains.com/zh-cn/webstorm/download</a> js IDE</p>
<p>下载Node.js <a class="link" href="https://nodejs.org/zh-cn/download/prebuilt-binaries"  target="_blank" rel="noopener"
    >https://nodejs.org/zh-cn/download/prebuilt-binaries</a> js解释器</p>
<p>frida代码补全提示配置:</p>
<p>创建项目后,在根目录打开cmd ,执行以下代码后安装代码补全包自动开启</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm i @types/frida-gum
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h2 id="frida对应关系表">frida对应关系表
</h2><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Android版本</th>
          <th>frida版本</th>
          <th>frida-tools版本</th>
          <th>python版本</th>
          <th>objection版本</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>android5-6</td>
          <td>frida12.3.6</td>
          <td></td>
          <td>python=3.7</td>
          <td></td>
      </tr>
      <tr>
          <td>andorid7-8</td>
          <td>frida12.8.0</td>
          <td>frida-tools=5.3.0</td>
          <td>python=3.8</td>
          <td>objection=1.8.4</td>
      </tr>
      <tr>
          <td>andorid9-10</td>
          <td>frida14.2.14</td>
          <td>frida-tools=9.2.2</td>
          <td>python=3.8</td>
          <td>objection=1.11.0</td>
      </tr>
      <tr>
          <td>andorid10-12</td>
          <td>frida15.2.2</td>
          <td>frida-tools=11.0.0</td>
          <td>python=3.9/3.10</td>
          <td></td>
      </tr>
      <tr>
          <td>android10-12</td>
          <td>frida15+</td>
          <td></td>
          <td>python=3.9/3.10</td>
          <td></td>
      </tr>
      <tr>
          <td>android12+</td>
          <td>frida16.0.19</td>
          <td></td>
          <td>python=3.10/3.11</td>
          <td></td>
      </tr>
  </tbody>
</table></div>
<p>frida12 最好在&lt;=安卓8.1的版本上用，最好别在&gt;=安卓10上用
frida14 最好在&gt;=安卓10的版本上用，别在&lt;=8.1的版本上用</p>
<h1 id="三-frida常用命令">三. Frida常用命令
</h1><h2 id="frida命令参数">frida命令参数
</h2><p>-U: 指定USB设备</p>
<p>-D: 指定id设备</p>
<p>-R: 远程frida-server</p>
<p>-H: 指定远程frida-server地址 ip:port</p>
<p>-f: swapn模式</p>
<p>-p: attach的目标pid</p>
<p>-n: attach的目标名称</p>
<p>-F: attach模式(默认)</p>
<p>-l: 加载脚本</p>
<p>-o: 输出日志到指定文件</p>
<p>&ndash;no-pause: spawn启动app时不挂起,直接运行</p>
<h2 id="列出手机进程信息">列出手机进程信息
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> frida-ps -Uai
</span></span></code></pre></td></tr></table>
</div>
</div><p>-U: 指定USB设备</p>
<p>-a: 列出所有进程</p>
<p>-i: 显示进程详细信息</p>
<h2 id="frida注入进程">frida注入进程
</h2><p>附加注入进程 直接注入后可使用控制台调用frida api进行交互</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">frida</span> <span class="o">-</span><span class="nx">U</span> <span class="o">&lt;</span><span class="nx">package_name</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>附加注入进程并加载脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">frida -U <span class="p">&lt;</span>package_name<span class="p">&gt;</span> -l <span class="p">&lt;</span>script.js&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>swapn注入进程并加载脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">frida -U -f <span class="p">&lt;</span>package_name<span class="p">&gt;</span> -l <span class="p">&lt;</span>script.js&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="四-frida-labs">四. Frida-labs
</h1><p>用于入门熟悉frida的基本hook操作,包括java和native层hook</p>
<p>参考https://github.com/DERE-ad2001/Frida-labs和<a class="link" href="https://bbs.kanxue.com/thread-280758.htm#msg_header_h2_9"  target="_blank" rel="noopener"
    >[原创]Frida-Hook-Java层操作大全</a></p>
<h2 id="lab1-overloadimplement-method">lab1 Overload&amp;Implement Method
</h2><p>hook重载函数并实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">mainActivity</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x1.MainActivity&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mainActivity</span><span class="p">.</span><span class="nx">check</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s2">&#34;int&#34;</span><span class="p">,</span><span class="s2">&#34;int&#34;</span><span class="p">).</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Origin i=&#34;</span><span class="p">,</span><span class="nx">x</span><span class="p">,</span><span class="s2">&#34;i2=&#34;</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab2-callstaticmethod">lab2 CallStaticMethod
</h2><p>MainActivity的静态方法get_flag(),当参数a==4919时getflag</p>
<p><img src="/p/fridastudy/frida-lab2-MainActivity.png"
	width="1263"
	height="858"
	srcset="/p/fridastudy/frida-lab2-MainActivity_hu_8019cb7c35b10bc2.png 480w, /p/fridastudy/frida-lab2-MainActivity_hu_3e18640130f9c94a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="147"
		data-flex-basis="353px"
	
></p>
<p>获取MainActivity类,主动调用get_flag()即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">mainActivity</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x2.MainActivity&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mainActivity</span><span class="p">.</span><span class="nx">get_flag</span><span class="p">(</span><span class="mi">4919</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab3-modifystaticvalue">lab3 ModifyStaticValue
</h2><p>当Checker.code==512时getflag</p>
<p><img src="/p/fridastudy/frida-lab3-MainActivity.png"
	width="1272"
	height="596"
	srcset="/p/fridastudy/frida-lab3-MainActivity_hu_8cce5e5828135630.png 480w, /p/fridastudy/frida-lab3-MainActivity_hu_70345aef26db6ed5.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="213"
		data-flex-basis="512px"
	
></p>
<p>Checker.code为静态变量</p>
<p><img src="/p/fridastudy/frida-lab3-Checker.png"
	width="389"
	height="224"
	srcset="/p/fridastudy/frida-lab3-Checker_hu_1fff75d52eb18d6f.png 480w, /p/fridastudy/frida-lab3-Checker_hu_7a2ac0c9fb5f80a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="173"
		data-flex-basis="416px"
	
></p>
<p>获取Checker类,通过.value直接修改静态变量code的值即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">Checker</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x3.Checker&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Checker</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Checker</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="mi">512</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab4-callinstancemethod">lab4 CallInstanceMethod
</h2><p>MainActivity没有getflag逻辑,在Check类中有实例方法get_flag</p>
<p><img src="/p/fridastudy/frida-lab4-Checker.png"
	width="845"
	height="330"
	srcset="/p/fridastudy/frida-lab4-Checker_hu_12fdfbe105c7a558.png 480w, /p/fridastudy/frida-lab4-Checker_hu_b0bc33ee72e45939.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="256"
		data-flex-basis="614px"
	
></p>
<p>获取Check类并调用new方法创建实例,之后调用get_flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">Check</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x4.Check&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Check</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">instance</span><span class="o">=</span><span class="nx">Check</span><span class="p">.</span><span class="nx">$new</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">flag</span><span class="o">=</span><span class="nx">instance</span><span class="p">.</span><span class="nx">get_flag</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab5-findinstance">lab5 FindInstance
</h2><p>MainActivity的实例方法flag</p>
<p><img src="/p/fridastudy/frida-lab5-MainActivity.png"
	width="1157"
	height="848"
	srcset="/p/fridastudy/frida-lab5-MainActivity_hu_4249097f1996b4ac.png 480w, /p/fridastudy/frida-lab5-MainActivity_hu_ce0c6a2e0c707f95.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="136"
		data-flex-basis="327px"
	
></p>
<p>在app启动时会创建MainActivity实例,此时我们如果使用Java.use获取MainActivity类并调用new创建实例,会导致错误</p>
<p>因为Android的UI组件依赖程序上下文运行,并且已经和MainActivity实例绑定,再次创建实例显然不行</p>
<p>通过Java.choose搜索实例对象,之后通过onMatch()回调进行hook逻辑,onComplete()进行结束处理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Java</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x5.MainActivity&#34;</span><span class="p">,{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onMatch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">instance</span><span class="p">.</span><span class="nx">flag</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onComplete</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;unhook&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab6-newinstance">lab6 NewInstance
</h2><p>MainActivity.get_flag()实例方法要求传入一个Checker实例对象</p>
<p>当实例对象的num1==1234且num2==4321时获取flag</p>
<p><img src="/p/fridastudy/frida-lab6-MainActivity.png"
	width="1655"
	height="834"
	srcset="/p/fridastudy/frida-lab6-MainActivity_hu_34fba0a2dd0384a6.png 480w, /p/fridastudy/frida-lab6-MainActivity_hu_e08baf78adfca685.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="198"
		data-flex-basis="476px"
	
></p>
<p>Checker.num1/num2均为实例变量</p>
<p><img src="/p/fridastudy/frida-lab6-Checker.png"
	width="366"
	height="177"
	srcset="/p/fridastudy/frida-lab6-Checker_hu_9774a8f711f49284.png 480w, /p/fridastudy/frida-lab6-Checker_hu_1d4cc28f578a9adb.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="206"
		data-flex-basis="496px"
	
></p>
<p>搜索MainActivity实例,之后创建Checker实例修改num变量,调用MainActivity.get_flag()</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">getclass</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">className</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Java</span><span class="p">.</span><span class="nx">choose</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x6.MainActivity&#34;</span><span class="p">,{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onMatch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;hook success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">Checker</span><span class="o">=</span><span class="nx">getclass</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x6.Checker&#34;</span><span class="p">).</span><span class="nx">$new</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Checker</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nx">Checker</span><span class="p">.</span><span class="nx">num1</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="mi">1234</span>
</span></span><span class="line"><span class="cl">                <span class="nx">Checker</span><span class="p">.</span><span class="nx">num2</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="mi">4321</span>
</span></span><span class="line"><span class="cl">                <span class="nx">instance</span><span class="p">.</span><span class="nx">get_flag</span><span class="p">(</span><span class="nx">Checker</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onComplete</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;unhook&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab7-hookconstructor">lab7 HookConstructor
</h2><p>MainActivity创建时生成Checker实例对象,通过构造函数传递123,321,调用flag方法</p>
<p><img src="/p/fridastudy/frida-lab7-MainActivity.png"
	width="1266"
	height="814"
	srcset="/p/fridastudy/frida-lab7-MainActivity_hu_9c41fbf51f8bf2b3.png 480w, /p/fridastudy/frida-lab7-MainActivity_hu_7f0b3ab3852980a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="155"
		data-flex-basis="373px"
	
></p>
<p>Checker对象默认的构造函数如下</p>
<p><img src="/p/fridastudy/frida-lab7-Checker.png"
	width="391"
	height="293"
	srcset="/p/fridastudy/frida-lab7-Checker_hu_b07c6ed2c6ad062c.png 480w, /p/fridastudy/frida-lab7-Checker_hu_ad9c9c5907979b75.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="133"
		data-flex-basis="320px"
	
></p>
<p>显然默认情况下构造函数传参不满足getflag条件</p>
<p>frida中&lt;class&gt;.$init表示类的构造函数,我们可以hookChecker的构造函数,修改传入的a,b值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x7.Checker&#34;</span><span class="p">).</span><span class="nx">$init</span><span class="p">.</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Origin a=&#34;</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="s2">&#34; b=&#34;</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">$init</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setImmediate</span><span class="p">(</span><span class="nx">main</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意需要以spawn模式启动(保证在MainActivity.onCreate执行前hook)</p>
<h2 id="lab8-hooknaticefunc">lab8 HookNaticeFunc
</h2><p>关键函数cmpstr为Native函数,在libfrida0x8.so中定义</p>
<p><img src="/p/fridastudy/frida-lab8-MainActivity.png"
	width="1032"
	height="757"
	srcset="/p/fridastudy/frida-lab8-MainActivity_hu_6b43299e78997ca4.png 480w, /p/fridastudy/frida-lab8-MainActivity_hu_f60b89a3604f2546.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="136"
		data-flex-basis="327px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//获取libc的strcmp地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">strcmp_addr</span><span class="o">=</span><span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="s2">&#34;libc.so&#34;</span><span class="p">,</span><span class="s2">&#34;strcmp&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">strcmp_addr</span> <span class="p">,{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onEnter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">arg0</span><span class="o">=</span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="c1">//strcmp(str1,str2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kd">var</span> <span class="nx">flag</span><span class="o">=</span><span class="nx">Memory</span><span class="p">.</span><span class="nx">readUtf8String</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//判断参数1确认为点击submit提交输入时,防止输出其他调用处字符串干扰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span><span class="p">(</span><span class="nx">arg0</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;input: &#34;</span><span class="p">,</span><span class="nx">arg0</span><span class="p">,</span><span class="s2">&#34;\nflag: &#34;</span><span class="p">,</span><span class="nx">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onLeave</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">retval</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setImmediate</span><span class="p">(</span><span class="nx">main</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab9-replacenativefuncretval">lab9 ReplaceNativeFuncRetval
</h2><p><img src="/p/fridastudy/frida-lab9-MainActivity.png"
	width="1185"
	height="659"
	srcset="/p/fridastudy/frida-lab9-MainActivity_hu_4e136d739ae137f2.png 480w, /p/fridastudy/frida-lab9-MainActivity_hu_5a062c9d1c9241fd.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="179"
		data-flex-basis="431px"
	
></p>
<p>hook到check_flag函数后通过retval.replace修改返回地址即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">check_flag_addr</span><span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="s2">&#34;liba0x9.so&#34;</span><span class="p">,</span><span class="s2">&#34;Java_com_ad2001_a0x9_MainActivity_check_1flag&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">check_flag_addr</span> <span class="p">,{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onEnter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hook check_flag success &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onLeave</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">retval</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;origin retval=&#34;</span><span class="p">,</span><span class="nx">retval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">retval</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="mi">1337</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setImmediate</span><span class="p">(</span><span class="nx">main</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab10-callnativefunc">lab10 CallNativeFunc
</h2><p>MainActivity只能看到stringFromJNI,但跟进发现该函数只返回&quot;Hello Hackers&quot;</p>
<p><img src="/p/fridastudy/frida-laba-MainActivity.png"
	width="932"
	height="656"
	srcset="/p/fridastudy/frida-laba-MainActivity_hu_95c27b5dc77497a9.png 480w, /p/fridastudy/frida-laba-MainActivity_hu_d87bb4f004247cb6.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="142"
		data-flex-basis="340px"
	
></p>
<p>搜索发现libfrida0xa.so存在一个导出的get_flag函数,没有被调用</p>
<p><img src="/p/fridastudy/frida-laba-get_flag.png"
	width="1034"
	height="398"
	srcset="/p/fridastudy/frida-laba-get_flag_hu_f08310f837c21936.png 480w, /p/fridastudy/frida-laba-get_flag_hu_79215baba3a916c1.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="259"
		data-flex-basis="623px"
	
></p>
<p>通过基址+偏移得到函数真实地址,再通过NativeFunction创建函数对象,之后直接调用即可再logcat看到flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//lib加载基址+get_flag偏移=真实地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//get_flag的Native名称为_Z8get_flagii
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">addr</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">findBaseAddress</span><span class="p">(</span><span class="s2">&#34;libfrida0xa.so&#34;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="mh">0x1dd60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">get_flag_ptr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NativePointer</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span><span class="c1">//Native层指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//获取Native函数对象 参数分别为函数指针,返回值类型,参数类型列表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">const</span> <span class="nx">get_flag</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NativeFunction</span><span class="p">(</span><span class="nx">get_flag_ptr</span><span class="p">,</span> <span class="s1">&#39;void&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">get_flag</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lab11-patchnativeinstruction">lab11 PatchNativeInstruction
</h2><p>调用Native函数getFlag</p>
<p><img src="/p/fridastudy/frida-labb-MainActivity.png"
	width="906"
	height="823"
	srcset="/p/fridastudy/frida-labb-MainActivity_hu_1e6be38080d8a6d2.png 480w, /p/fridastudy/frida-labb-MainActivity_hu_8900fc3df8567669.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="110"
		data-flex-basis="264px"
	
></p>
<p>此处为永假跳转,patch掉if跳转逻辑即可绕过</p>
<p><img src="/p/fridastudy/frida-labb-getFlag.png"
	width="971"
	height="891"
	srcset="/p/fridastudy/frida-labb-getFlag_hu_df7f0ef4c78ade03.png 480w, /p/fridastudy/frida-labb-getFlag_hu_96aa4cb1b65d8bf2.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="108"
		data-flex-basis="261px"
	
></p>
<p>获取到目标patch地址后,通过Memory.protect取消页面保护, 再创建对应架构的Writer,通过writer修改指令即可</p>
<p>方法1 直接nop b.ne</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">addr</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">findBaseAddress</span><span class="p">(</span><span class="s2">&#34;libfrida0xb.so&#34;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="mh">0x15248</span><span class="p">);</span><span class="c1">//b.ne指令地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Memory</span><span class="p">.</span><span class="nx">protect</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="s2">&#34;rwx&#34;</span><span class="p">);</span><span class="c1">//修改页面保护属性为可读可写可执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Arm64Writer</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>  <span class="c1">// 创建Writer对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">writer</span><span class="p">.</span><span class="nx">putNop</span><span class="p">()</span><span class="c1">//直接nop b.ne跳转 注意arm64的nop=0xD503201F,长度为4,只需要调用一次即可
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="nx">writer</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span><span class="c1">//刷新缓冲区,保证成功写入指令
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Nop instruction inserted at </span><span class="si">${</span><span class="nx">addr</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">writer</span><span class="p">.</span><span class="nx">dispose</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>方法2 修改b.ne跳转地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">addr</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">findBaseAddress</span><span class="p">(</span><span class="s2">&#34;libfrida0xb.so&#34;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="mh">0x15248</span><span class="p">);</span><span class="c1">//b.ne指令地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Memory</span><span class="p">.</span><span class="nx">protect</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="s2">&#34;rwx&#34;</span><span class="p">);</span><span class="c1">//修改页面保护属性为可读可写可执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Arm64Writer</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>  <span class="c1">// 创建Writer对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">findBaseAddress</span><span class="p">(</span><span class="s2">&#34;libfrida0xb.so&#34;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="mh">0x15250</span><span class="p">);</span><span class="c1">//跳转的目标地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">writer</span><span class="p">.</span><span class="nx">putBImm</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span> <span class="c1">//B target
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">writer</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span><span class="c1">//刷新缓冲区,保证成功写入指令
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Branch instruction inserted at </span><span class="si">${</span><span class="nx">addr</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">writer</span><span class="p">.</span><span class="nx">dispose</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="五-fridahook进阶">五. FridaHook进阶
</h1><h2 id="frida的数据结构">Frida的数据结构
</h2><h3 id="数组">数组
</h3><p>frida会自动将js字符串转换为java字符串,但传递基本数据类型时,不会转换成封装类型,frida提供了api进行转换:</p>
<p>Java.array(&ldquo;Ljava.lang.Object;&rdquo;&hellip;)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">Integer</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.Integer&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nb">Boolean</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.Boolean&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">strarr</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Ljava.lang.String;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="s2">&#34;hello&#34;</span><span class="p">,</span><span class="nb">Boolean</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="nx">Integer</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="mi">666</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="打印枚举操作">打印/枚举操作
</h2><h3 id="show-stacktrace">Show StackTrace
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">showStacks</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;====================StackTraceStart====================&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.util.Log&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="nx">getStackTraceString</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.Throwable&#34;</span><span class="p">).</span><span class="nx">$new</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;=====================StackTraceEnd=====================&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="枚举类的所有属性和方法">枚举类的所有属性和方法
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">mainActivity</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x6.MainActivity&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//以下均为Java.class自带的方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">methods</span><span class="o">=</span><span class="nx">mainActivity</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getDeclaredMethods</span><span class="p">();</span>            <span class="c1">//方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">constructors</span><span class="o">=</span><span class="nx">mainActivity</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getDeclaredConstructors</span><span class="p">();</span>  <span class="c1">//构造函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">fields</span><span class="o">=</span><span class="nx">mainActivity</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getDeclaredFields</span><span class="p">();</span>              <span class="c1">//字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">classes</span><span class="o">=</span><span class="nx">mainActivity</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getDeclaredClasses</span><span class="p">();</span>            <span class="c1">//内部类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n==========methods==========&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">methods</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">methods</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n==========constructors==========&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">constructors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">constructors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n==========fields==========&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">fields</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fields</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n==========classes==========&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">classes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">classes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="打印类实例的详细信息">打印类/实例的详细信息
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">printClassMethods</span><span class="p">(</span><span class="nx">Class</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">methods</span><span class="o">=</span><span class="nx">Class</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getDeclaredMethods</span><span class="p">();</span>            <span class="c1">//方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n==========methods==========&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">methods</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">methodParams</span><span class="o">=</span><span class="nx">methods</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getParameterTypes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">methodReturnType</span><span class="o">=</span><span class="nx">methods</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getReturnType</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">methodName</span><span class="o">=</span><span class="nx">methods</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">methodReturnType</span><span class="o">+</span><span class="s2">&#34; &#34;</span><span class="o">+</span><span class="nx">methodName</span><span class="o">+</span><span class="s2">&#34;(&#34;</span><span class="o">+</span><span class="nx">methodParams</span><span class="o">+</span><span class="s2">&#34;)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">printClassFields</span><span class="p">(</span><span class="nx">Class</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">fields</span><span class="o">=</span><span class="nx">Class</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getDeclaredFields</span><span class="p">();</span>              <span class="c1">//字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n==========fields==========&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">fields</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">fieldName</span><span class="o">=</span><span class="nx">fields</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">fieldType</span><span class="o">=</span><span class="nx">fields</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getType</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fieldType</span><span class="p">,</span><span class="nx">fieldName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">printInstanceMethods</span><span class="p">(</span><span class="nx">Instance</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">printClassMethods</span><span class="p">(</span><span class="nx">Instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">printInstanceFields</span><span class="p">(</span><span class="nx">Instance</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">fields</span><span class="o">=</span><span class="nx">Instance</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getDeclaredFields</span><span class="p">();</span>              <span class="c1">//字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;\n==========fields==========&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">fields</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">fieldName</span><span class="o">=</span><span class="nx">fields</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">fieldType</span><span class="o">=</span><span class="nx">fields</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getType</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">fieldValue</span><span class="o">=</span><span class="nx">Instance</span><span class="p">[</span><span class="nx">fieldName</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fieldType</span><span class="p">,</span><span class="nx">fieldName</span><span class="p">,</span><span class="s2">&#34;=&#34;</span><span class="p">,</span><span class="nx">fieldValue</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//打印实例详细信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">printInstance</span><span class="p">(</span><span class="nx">Instance</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">printInstanceFields</span><span class="p">(</span><span class="nx">Instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">printInstanceMethods</span><span class="p">(</span><span class="nx">Instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//打印类的详细信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">printClass</span><span class="p">(</span><span class="nx">Class</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">printClassFields</span><span class="p">(</span><span class="nx">Class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">printClassMethods</span><span class="p">(</span><span class="nx">Class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="枚举所有已加载类">枚举所有已加载类
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">       <span class="kd">var</span> <span class="nx">classes</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">enumerateLoadedClassesSync</span><span class="p">()</span><span class="c1">//string[]数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">classes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;\n&#34;</span><span class="p">))</span><span class="c1">//每个元素添加换行打印
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hook-java类方法">Hook Java类/方法
</h2><h3 id="hook内部类和匿名类">hook内部类和匿名类
</h3><p>内部类通过$classname, 匿名类通过$classnum, classnum编号和匿名类的创建顺序有关,例如:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">       <span class="kd">var</span> <span class="nx">innerClass</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.example.app.MainActivity$InnerClass&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="kd">var</span> <span class="nx">anonymousClass</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.example.app.MainActivity$6&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="hook类的所有方法">hook类的所有方法
</h3><p>hook类的所有方法,包括方法的所有重载</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">function</span> <span class="nx">hookFunc</span><span class="p">(</span><span class="nx">methodName</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;hook&#34;</span><span class="o">+</span><span class="nx">methodName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">overloadsArr</span><span class="o">=</span><span class="nx">mainActivity</span><span class="p">[</span><span class="nx">methodName</span><span class="p">].</span><span class="nx">overloads</span><span class="p">;</span><span class="c1">//获取指定方法的所有重载
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">overloadsArr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span><span class="c1">//hook所有重载
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hook all overloads start&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nx">overloadsArr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">                    <span class="kd">let</span> <span class="nx">params</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">j</span><span class="o">&lt;</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">j</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">params</span><span class="o">+=</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34; &#34;</span><span class="c1">//存储参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">methodName</span><span class="o">+</span><span class="s2">&#34;is called!Params is:&#34;</span><span class="o">+</span><span class="nx">params</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">methodName</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span><span class="c1">//针对不同重载返回所有参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">mainActivity</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x6.MainActivity&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">methods</span><span class="o">=</span><span class="nx">mainActivity</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getDeclaredMethods</span><span class="p">();</span>            <span class="c1">//方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">methods</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">           <span class="kd">let</span> <span class="nx">methodName</span><span class="o">=</span><span class="nx">methods</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">           <span class="nx">hookFunc</span><span class="p">(</span><span class="nx">methodName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setImmediate</span><span class="p">(</span><span class="nx">main</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="注册java类并调用">注册java类并调用
</h3><p>Java.registerClass</p>
<p>参照官方文档</p>
<p>使用JSON格式创建类,其中一般方法可以直接写代码,重载方法以数组形式分别编写implementation</p>
<p>注册成功后便可以调用,该api适合简单场景,复杂场景适合注入dex</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">MyWeirdTrustManager</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">registerClass</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;com.example.MyWeirdTrustManager&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">superClass</span><span class="o">:</span> <span class="nx">SomeBaseClass</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kr">implements</span><span class="o">:</span> <span class="p">[</span><span class="nx">X509TrustManager</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fields</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">limit</span><span class="o">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Constructor called&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">checkClientTrusted</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span> <span class="nx">authType</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;checkClientTrusted&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">checkServerTrusted</span><span class="o">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">returnType</span><span class="o">:</span> <span class="s1">&#39;void&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">argumentTypes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;[Ljava.security.cert.X509Certificate;&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">implementation</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span> <span class="nx">authType</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;checkServerTrusted A&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">returnType</span><span class="o">:</span> <span class="s1">&#39;java.util.List&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">argumentTypes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;[Ljava.security.cert.X509Certificate;&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">implementation</span><span class="p">(</span><span class="nx">chain</span><span class="p">,</span> <span class="nx">authType</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;checkServerTrusted B&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}],</span>
</span></span><span class="line"><span class="cl">    <span class="nx">getAcceptedIssuers</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;getAcceptedIssuers&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="hook只在指定函数内生效">hook只在指定函数内生效
</h3><p>部分函数调用可能比较频繁,hook后可能导致崩溃,此时需要再制定范围内hook</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">mainActivity</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.xiaojianbang.app.MainActivity&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">stringBuilder</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.StringBuilder&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mainActivity</span><span class="p">.</span><span class="nx">generateAESKey</span><span class="p">.</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hook MainActivity generateAESKey Succeeded!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//在执行generateAESKey时,对StringBuilder进行hook
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">stringBuilder</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hook StringBuilder Succeeded!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="c1">//打印原始数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">generateAESKey</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="c1">//js function.apply(object,argArray) 调用函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//结束后取消hook 注意一定要先apply调用hook后的generateAESKey
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//如果unhook stringBuilder 再执行result=this.generateAESKey.apply(this,arguments);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//会导致内部对stringBuilder的hook失效,只执行第一行log
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">stringBuilder</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">implementation</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="c1">//unhook
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="定位接口抽象类的实现类">定位接口/抽象类的实现类
</h3><p>实现接口/抽象类的类,执行到覆写的方法时必定不走父类</p>
<p>当我们希望定位某个接口/抽象类有哪些实现时,可以遍历所有已加载类</p>
<p>获取对应class后调用getInterfaces()/getSuperclass()获取对应的实现接口数组/父类</p>
<p>接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//寻找指定app中指定接口的所有实现
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">findInterfaceImplementations</span><span class="p">(</span><span class="nx">packageName</span><span class="p">,</span><span class="nx">interfaceName</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">classes</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">enumerateLoadedClassesSync</span><span class="p">();</span><span class="c1">//遍历所有已加载的类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//console.log(&#34;classes:&#34;,classes.join(&#34;\n&#34;))
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">classes</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">className</span><span class="o">=</span><span class="nx">classes</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span><span class="c1">//js的for-in中,index为下标而非元素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">packageName</span><span class="p">)</span><span class="o">===-</span><span class="mi">1</span><span class="p">)</span><span class="c1">//不是目标app的类,继续搜索
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">clazz</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span><span class="c1">//获取目标类,并获取所有实现的接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kd">var</span> <span class="nx">interfaces</span><span class="o">=</span><span class="nx">clazz</span><span class="p">.</span><span class="kr">class</span><span class="p">.</span><span class="nx">getInterfaces</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span><span class="c1">//实现的接口为0,跳过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//有实现的接口,判断是否为目标接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//包括目标接口名,打印所有接口数组信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//注意interfaces为Class&lt;?&gt;[]类型,转换为字符串判断
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span><span class="p">(</span><span class="nx">interfaces</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">toString</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">interfaceName</span><span class="p">)</span><span class="o">!==-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">className</span><span class="p">,</span><span class="nx">interfaces</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Didn&#39;t find class&#34;</span><span class="p">,</span><span class="nx">className</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">findInterfaceImplementations</span><span class="p">(</span><span class="s2">&#34;com.xiaojianbang.app&#34;</span><span class="p">,</span><span class="s2">&#34;com.xiaojianbang.app.TestRegisterClass&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>抽象类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">findAbstractClassImplementations</span><span class="p">(</span><span class="nx">packageName</span><span class="p">,</span><span class="nx">abstractClassName</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">classes</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">enumerateLoadedClassesSync</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">classes</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">className</span><span class="o">=</span><span class="nx">classes</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">packageName</span><span class="p">)</span><span class="o">===-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">superClass</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">className</span><span class="p">).</span><span class="kr">class</span><span class="p">.</span><span class="nx">getSuperclass</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">superClass</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//一个类只能继承一个父类,故抽象类无需遍历
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span><span class="p">(</span><span class="nx">superClass</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">abstractClassName</span><span class="p">)</span><span class="o">!==-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">className</span><span class="p">,</span><span class="nx">superClass</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Didn&#39;t find class&#34;</span><span class="p">,</span><span class="nx">className</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">findAbstractClassImplementations</span><span class="p">(</span><span class="s2">&#34;com.xiaojianbang.app&#34;</span><span class="p">,</span><span class="s2">&#34;com.xiaojianbang.app.TestAbstract&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="dex操作">Dex操作
</h2><h3 id="注入dex文件">注入dex文件
</h3><p>用js写代码不方便,使用java编写类和方法后编译为dex文件并注入,方便调用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Java</span><span class="p">.</span><span class="nx">openFile</span><span class="p">(</span><span class="s2">&#34;/data/local/tmp/patch.dex&#34;</span><span class="p">).</span><span class="nx">load</span><span class="p">()</span><span class="c1">//加载dex文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">MyClass</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;con.example.app.MyClass&#34;</span><span class="p">)</span><span class="c1">//获取类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">instance</span><span class="o">=</span><span class="nx">MyClass</span><span class="p">.</span><span class="nx">$new</span><span class="p">()</span><span class="c1">//创建类实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">instance</span><span class="p">.</span><span class="nx">hello</span><span class="p">()</span><span class="c1">//调用方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="hook动态加载的dex">hook动态加载的dex
</h3><p>当使用Java.enumerateLoadedClassesSync() 枚举已经加载的类,但反编译找不到该类时,说明该类可能是动态加载的,此时需要通过ClassLoader获取该类</p>
<p>Java.enumerateClassLoaders() 枚举类加载器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Java</span><span class="p">.</span><span class="nx">enumerateClassLoaders</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onMatch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">loader</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">Java</span><span class="p">.</span><span class="nx">classFactory</span><span class="p">.</span><span class="nx">loader</span><span class="o">=</span><span class="nx">loader</span><span class="p">;</span><span class="c1">//替换frida默认的classloader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="kd">var</span> <span class="nx">dynamic</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.xiaojianbang.app.Dynamic&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;dynamic: &#34;</span><span class="p">,</span><span class="nx">dynamic</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">dynamic</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">.</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hook dynamic.sayHello Success!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="s2">&#34;glass&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">dynamic</span><span class="p">.</span><span class="nx">$new</span><span class="p">().</span><span class="nx">sayHello</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">loader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onComplete</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//所有ClassLoader加载完毕时调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>hook成功</p>
<p><img src="/p/fridastudy/HookDynamicLoadClass.png"
	width="1821"
	height="381"
	srcset="/p/fridastudy/HookDynamicLoadClass_hu_c646d6faa4a428d8.png 480w, /p/fridastudy/HookDynamicLoadClass_hu_9a62d7bd5c765935.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="477"
		data-flex-basis="1147px"
	
></p>
<h2 id="hook-java数据结构待完善">Hook Java数据结构(待完善)
</h2><h3 id="hashmap">HashMap
</h3><p>HashMap, LinkedHashMap, HashSet, LinkedHashSet, java.util.concurrent.ConcurrentHashMap</p>
<p>hook put方法示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">hashMap</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.util.HashMap&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">hashMap</span><span class="p">.</span><span class="nx">put</span><span class="p">.</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//注意String key为java类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="s2">&#34;username&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;hashMap.put: &#34;</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="arraylist">ArrayList
</h3><p>ArrayList, Vector, LinkList的add(), addAll(), set()等方法</p>
<h3 id="string">String
</h3><p>getBytes() isEmpty() 构造函数java.lang.StringFactory</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">string</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.String&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">string</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">.</span><span class="nx">overload</span><span class="p">().</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">showStacks</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">newStr</span><span class="o">=</span><span class="nx">string</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;string.getBytes result:&#34;</span><span class="p">,</span><span class="nx">newStr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">string</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s2">&#34;java.lang.String&#34;</span><span class="p">).</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">showStacks</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">newStr</span><span class="o">=</span><span class="nx">string</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="nx">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;string.getBytes result:&#34;</span><span class="p">,</span><span class="nx">newStr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="stringfactory">StringFactory
</h3><p>String的构造函数实际上调用的是StringFactory</p>
<h3 id="stringbuilder">StringBuilder
</h3><h2 id="hook-标准加密库待完善">Hook 标准加密库(待完善)
</h2><p>标准加密库算法</p>
<h2 id="hook-android组件待完善">Hook Android组件(待完善)
</h2><h3 id="toast">Toast
</h3><p>例如输入的账号密码错误时通过toast提示即可快速定位</p>
<h2 id="native-hook">Native Hook
</h2><p>通过Interceptor.attach可以hooknative层函数,不过此时需要传递函数首地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">targetAddress</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">onEnter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Modify or log arguments if needed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">onLeave</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">retval</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Modify or log return value if needed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>相关API</p>
<ul>
<li>
<p>Module.enumerateExports(libname)</p>
<p>遍历lib的导出表,获取导出函数相关信息</p>
<p><img src="/p/fridastudy/frida-lab8-enumerateExports.png"
	width="805"
	height="499"
	srcset="/p/fridastudy/frida-lab8-enumerateExports_hu_36ec8e0c391c2672.png 480w, /p/fridastudy/frida-lab8-enumerateExports_hu_a182aa52aadd7093.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="161"
		data-flex-basis="387px"
	
></p>
</li>
<li>
<p>Module.enumerateImports(libname)</p>
<p>遍历lib的导入表,获取导入函数相关信息</p>
<p><img src="/p/fridastudy/frida-lab8-enumerateImports.png"
	width="809"
	height="839"
	srcset="/p/fridastudy/frida-lab8-enumerateImports_hu_cbd1e9b964ce63d7.png 480w, /p/fridastudy/frida-lab8-enumerateImports_hu_72ab049829332950.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="96"
		data-flex-basis="231px"
	
></p>
</li>
<li>
<p>Module.getExportByName(libname,funcname)</p>
<p>到指定lib查找指定函数地址,未找到返回异常</p>
</li>
<li>
<p>Module.findExportByName(libname,funcname)</p>
<p>到指定lib查找指定函数地址,未找到返回null</p>
</li>
<li>
<p>Module.getBaseAddress(libname)</p>
<p>获取lib的基址</p>
<p><img src="/p/fridastudy/frida-labs8-otherfuncs.png"
	width="1266"
	height="328"
	srcset="/p/fridastudy/frida-labs8-otherfuncs_hu_6cda1687fcb8d89d.png 480w, /p/fridastudy/frida-labs8-otherfuncs_hu_7e26641d3a50d5fe.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="385"
		data-flex-basis="926px"
	
></p>
</li>
</ul>
<p>主动调用Native函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">native_adr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NativePointer</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">address_of_the_native_function</span><span class="o">&gt;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">native_function</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NativeFunction</span><span class="p">(</span><span class="nx">native_adr</span><span class="p">,</span> <span class="s1">&#39;&lt;return type&gt;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;argument_data_type&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nx">native_function</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">arguments</span><span class="o">&gt;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>指令patch 使用Writer</p>
<p><a class="link" href="https://frida.re/docs/javascript-api/#arm64writer"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#arm64writer</a></p>
<h2 id="其他操作">其他操作
</h2><h3 id="frida写文件">frida写文件
</h3><p>frida只有写文件没有读文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">ios</span><span class="o">=</span><span class="k">new</span> <span class="nx">File</span><span class="p">(</span><span class="s2">&#34;/sdcard/Download/helloworld.txt&#34;</span><span class="p">,</span><span class="s2">&#34;w&#34;</span><span class="p">)</span><span class="c1">//注意路径权限的问题
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">ios</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">&#34;Hello World!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ios</span><span class="p">.</span><span class="nx">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ios</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="六-fridatools">六. FridaTools
</h1><p>frida常用工具和插件的安装使用方法</p>
<h2 id="objection">Objection
</h2><p>由于frida更新较快,需要保证objection版本的发布时间在frida之后</p>
<p>最新的objection版本为1.11.0,对应的frida版本最大为14.2.14,frida-tools为9.2.2</p>
<p>objection注入成功后进入自带的shell页面-REPL</p>
<h3 id="objection常用指令">objection常用指令
</h3><p>注入目标进程(默认通过usb连接)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">objection -g com.android.settings explore 
</span></span><span class="line"><span class="cl"><span class="c1"># -g表示注入 explore表示自动搜索</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>指定ip和端口注入app</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">objection -N -h ip -p port -g processName explore
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动前执行hook命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">objection -g processName explore --startup-command <span class="s2">&#34;android hooking watch class &lt;path.className&gt;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="repl常用指令">REPL常用指令
</h3><p>jobs</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">jobs</span> list <span class="c1">#查看hook了多少个类</span>
</span></span><span class="line"><span class="cl"><span class="nb">jobs</span> <span class="nb">kill</span> &lt;jobId&gt; <span class="c1"># unhook</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Java Hook</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#列出所有已加载类</span>
</span></span><span class="line"><span class="cl">android hooking list classes 
</span></span><span class="line"><span class="cl"><span class="c1">#搜索包含关键字的类</span>
</span></span><span class="line"><span class="cl">android hooking search classes &lt;keyword&gt; 
</span></span><span class="line"><span class="cl"><span class="c1">#列举类的所有方法</span>
</span></span><span class="line"><span class="cl">android hooking list classes_methods &lt;path.className&gt; 
</span></span><span class="line"><span class="cl"><span class="c1"># 查看当前app的所有活动/广播接收器/内容提供器/服务</span>
</span></span><span class="line"><span class="cl">android hooking list activities/receivers/providers/services
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#hook类的所有方法(不包括构造方法)</span>
</span></span><span class="line"><span class="cl">android hooking watch class &lt;path.className&gt; 
</span></span><span class="line"><span class="cl"><span class="c1">#hook类的构造方法</span>
</span></span><span class="line"><span class="cl">android hooking watch class_method &lt;path.className.<span class="nv">$init</span>&gt; 
</span></span><span class="line"><span class="cl"><span class="c1">#hook指定类方法的所有重载</span>
</span></span><span class="line"><span class="cl">android hooking watch class_method &lt;path.className.methodName&gt; 
</span></span><span class="line"><span class="cl"><span class="c1">#hook单个重载函数</span>
</span></span><span class="line"><span class="cl">android hooking watch class_method &lt;path.className.methodName&gt; <span class="s2">&#34;&lt;argsType&gt;&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="c1"># hook方法的所有参数,返回值,调用栈 --dump-args --dump-return --dump-backtrace</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Native Hook</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 搜索堆中的实例</span>
</span></span><span class="line"><span class="cl">android heap search instances &lt;className&gt;
</span></span><span class="line"><span class="cl"><span class="c1"># 枚举内存中所有模块</span>
</span></span><span class="line"><span class="cl">memory list modules
</span></span><span class="line"><span class="cl"><span class="c1"># 枚举模块的所有导出函数</span>
</span></span><span class="line"><span class="cl">memory list exports &lt;libname.so&gt;
</span></span><span class="line"><span class="cl"><span class="c1"># 结果过多时可以导出到本地文件</span>
</span></span><span class="line"><span class="cl">memory list exports &lt;libname.so&gt; --json &lt;path.fileName&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>其他命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 尝试跳转到对应activity</span>
</span></span><span class="line"><span class="cl">android intent launch_activity 
</span></span><span class="line"><span class="cl"><span class="c1">#关闭ssl校验</span>
</span></span><span class="line"><span class="cl">android sslpinning disable 
</span></span><span class="line"><span class="cl"> <span class="c1">#关闭root检测</span>
</span></span><span class="line"><span class="cl">android root disable
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="wallbreaker">WallBreaker
</h2><p>官网https://github.com/hluwa/Wallbreaker</p>
<p>objection加载插件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">plugin load pluginPath Wallbreaker
</span></span></code></pre></td></tr></table>
</div>
</div><p>搜索类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">plugin wallbreaker classsearch &lt;pattern&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>搜索对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">plugin wallbreaker objectsearch
</span></span></code></pre></td></tr></table>
</div>
</div><p>classdump输出类结构</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">plugin wallbreaker classdump &lt;classname&gt; 
</span></span></code></pre></td></tr></table>
</div>
</div><p>objectdump</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">plugin wallbreaker objectdump &lt;instance&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="frida-dexdump">frida-dexdump
</h2><h1 id="七-frida持久化">七. Frida持久化
</h1><ol>
<li>
<p>手机上使用termux终端运行frida-server</p>
</li>
<li>
<p>frida-inject</p>
</li>
<li>
<p>frida-gadget.so</p>
<p>优点: 免root使用frida,frida-gadget比较稳定</p>
<p>缺点: 需要重打包app.可以通过魔改系统,让系统帮忙注入so免去重打包</p>
</li>
</ol>
<h2 id="frida-inject">frida-inject
</h2><p>参数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  -D, --device=ID                      connect to device with the given ID
</span></span><span class="line"><span class="cl">  -f, --file=FILE                      spawn FILE
</span></span><span class="line"><span class="cl">  -p, --pid=PID                        attach to PID
</span></span><span class="line"><span class="cl">  -n, --name=NAME                      attach to NAME
</span></span><span class="line"><span class="cl">  -r, --realm=REALM                    attach in REALM
</span></span><span class="line"><span class="cl">  -s, --script=JAVASCRIPT_FILENAME
</span></span><span class="line"><span class="cl">  -R, --runtime=qjs|v8                 Script runtime to use
</span></span><span class="line"><span class="cl">  -P, --parameters=PARAMETERS_JSON     Parameters as JSON, same as Gadget
</span></span><span class="line"><span class="cl">  -e, --eternalize                     Eternalize script and exit
</span></span><span class="line"><span class="cl">  -i, --interactive                    Interact with script through stdin
</span></span><span class="line"><span class="cl">  --development                        Enable development mode
</span></span><span class="line"><span class="cl">  --version                            Output version information and exit
</span></span></code></pre></td></tr></table>
</div>
</div><p>推送js脚本到手机端后,使用frida-inject运行脚本注入指定app</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">./frida-inject-16.0.19-android-arm64 -n com.example.app -s script.js -e
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="frida-gadget">frida-gadget
</h2><p><a class="link" href="https://github.com/frida/frida/releases?page=4"  target="_blank" rel="noopener"
    >https://github.com/frida/frida/releases?page=4</a></p>
<p>frida-gadget需要将so文件打包到apk,无需root权限</p>
<p>objection patchapk 参数介绍</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-s 指定目标apk文件
</span></span><span class="line"><span class="cl">-a 指定so的cpu平台       
</span></span><span class="line"><span class="cl">-V 指定gadget.so的版本
</span></span><span class="line"><span class="cl">-D 反编译时跳过资源
</span></span><span class="line"><span class="cl">-c 指定gadget的config文件路径
</span></span></code></pre></td></tr></table>
</div>
</div><p>环境需求</p>
<p>aapt</p>
<p>jarsigner</p>
<p>apktool,adb</p>
<p>Android系统对应so平台</p>
<h1 id="八-fridapython">八. FridaPython
</h1><p>为什么需要使用frida的python库</p>
<ol>
<li>
<p>js的frida操作多用于手工调试,如果需要代码自动化处理则要其他语言接入</p>
</li>
<li>
<p>frida的算法转发和frida的rpc都需要使用python</p>
<p>算法转发和rpc能使安卓逆向更加便捷</p>
</li>
<li>
<p>frida可以实时和python进行数据交互</p>
</li>
<li>
<p>python的各种哭让代码编写更加简单</p>
</li>
</ol>
<p>注意: python中的js脚本无法实时更新,必须重新运行py脚本</p>
<h2 id="python连接设备">python连接设备
</h2><h3 id="attach方式">attach方式
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">frida</span><span class="o">,</span><span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">jsCode</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">......
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">frida</span><span class="o">.</span><span class="n">get_usb_device</span><span class="p">()</span> <span class="c1">#获取usb设备</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;device: &#34;</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># attach指定进程 注意进程名不一定等于包名,可使用frida-ps判断</span>
</span></span><span class="line"><span class="cl"><span class="n">process</span><span class="o">=</span><span class="n">device</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="s2">&#34;Frida 0x6&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># process=device.attach(6666)# attach指定pid进程</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;process: &#34;</span><span class="p">,</span><span class="n">process</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">=</span><span class="n">process</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">jsCode</span><span class="p">)</span><span class="c1"># 创建并加载js脚本</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="c1"># 防止命令行关闭</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="spawn方式">spawn方式
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">frida</span><span class="o">,</span><span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">jsCode</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">......
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">frida</span><span class="o">.</span><span class="n">get_usb_device</span><span class="p">()</span> <span class="c1">#获取usb设备</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;device: &#34;</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pid</span><span class="o">=</span><span class="n">device</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s2">&#34;com.ad2001.frida0x6&#34;</span><span class="p">)</span><span class="c1"># spawn启动</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;pid: &#34;</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">process</span><span class="o">=</span><span class="n">device</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="c1"># 启动后需要附加</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;process: &#34;</span><span class="p">,</span><span class="n">process</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="c1">#阻塞后恢复运行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">=</span><span class="n">process</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">jsCode</span><span class="p">)</span><span class="c1"># 创建并执行js脚本</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="c1"># 防止命令行关闭</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="连接非标准端口设备">连接非标准端口设备
</h3><p>手机端以非标准端口启动frida-server</p>
<p>-l = &ndash;listen 指定监听地址 0.0.0.0:8888表示任意ip的8888端口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">./data/local/tmp/frida-server-16.0.19-android-arm64 -l 0.0.0.0:8888
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过device_manager添加远程设备</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">manager</span><span class="o">=</span><span class="n">frida</span><span class="o">.</span><span class="n">get_device_manager</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span><span class="o">=</span><span class="n">manager</span><span class="o">.</span><span class="n">add_remote_device</span><span class="p">(</span><span class="s2">&#34;192.168.189.179:8888&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">process</span><span class="o">=</span><span class="n">device</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="s2">&#34;Frida 0x6&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="frida与python交互">frida与python交互
</h2><h3 id="send">send
</h3><p>js脚本中使用send发送数据</p>
<p>python中使用script.on(&lsquo;message&rsquo;, messageFunc)注册消息处理函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: UTF-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">frida</span><span class="o">,</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">jsCode</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Java.perform(function(){
</span></span></span><span class="line"><span class="cl"><span class="s2">        var RequestUtil = Java.use(&#39;com.dodonew.online.http.RequestUtil&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        RequestUtil.encodeDesMap.overload(&#39;java.lang.String&#39;, &#39;java.lang.String&#39;, &#39;java.lang.String&#39;).implementation = function(a, b, c){
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;data: &#39;, a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;desKey: &#39;, b);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;desIV: &#39;, c);
</span></span></span><span class="line"><span class="cl"><span class="s2">            var retval = this.encodeDesMap(a, b, c);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;retval: &#39;, retval);
</span></span></span><span class="line"><span class="cl"><span class="s2">            return retval;
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">        var Utils = Java.use(&#39;com.dodonew.online.util.Utils&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        Utils.md5.implementation = function(a){
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;MD5 string: &#39;, a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            var retval = this.md5(a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            send(retval);
</span></span></span><span class="line"><span class="cl"><span class="s2">            return retval;
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">    });
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 接收send发送来的数据用于处理 注意必须为2个参数</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">messageFunc</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">   <span class="c1"># print(message)</span>
</span></span><span class="line"><span class="cl">   <span class="c1"># 当type为send时打印</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="n">message</span><span class="p">[</span><span class="s2">&#34;type&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;send&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="nb">print</span><span class="p">(</span><span class="sa">u</span><span class="s2">&#34;[*] </span><span class="si">{0}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">   <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">frida</span><span class="o">.</span><span class="n">get_usb_device</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">process</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="s1">&#39;嘟嘟牛在线&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">jsCode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">messageFunc</span><span class="p">)</span> <span class="c1">#注册message事件,参数1不能改,参数2随意</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Run Script&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>效果如下,成功接收消息并打印</p>
<p><img src="/FridaPython-Send.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="recv">recv
</h3><p>python中使用script.post( {name : data} )发送数据</p>
<p>js中使用recv(function(obj) { console.log(obj.data) } ).wait()等待接收并进行消息处理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: UTF-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">frida</span><span class="o">,</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">jsCode</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Java.perform(function(){
</span></span></span><span class="line"><span class="cl"><span class="s2">        var RequestUtil = Java.use(&#39;com.dodonew.online.http.RequestUtil&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        RequestUtil.encodeDesMap.overload(&#39;java.lang.String&#39;, &#39;java.lang.String&#39;, &#39;java.lang.String&#39;).implementation = function(a, b, c){
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;data: &#39;, a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;desKey: &#39;, b);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;desIV: &#39;, c);
</span></span></span><span class="line"><span class="cl"><span class="s2">            var retval = this.encodeDesMap(a, b, c);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;retval: &#39;, retval);
</span></span></span><span class="line"><span class="cl"><span class="s2">            return retval;
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">        var Utils = Java.use(&#39;com.dodonew.online.util.Utils&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        Utils.md5.implementation = function(a){
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;MD5 string: &#39;, a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            var retval = this.md5(a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            send(retval);
</span></span></span><span class="line"><span class="cl"><span class="s2">            //接收消息并处理
</span></span></span><span class="line"><span class="cl"><span class="s2">            recv(function(obj){
</span></span></span><span class="line"><span class="cl"><span class="s2">                console.log(JSON.stringify(obj));
</span></span></span><span class="line"><span class="cl"><span class="s2">                console.log(&#34;Python:&#34;, obj.data);
</span></span></span><span class="line"><span class="cl"><span class="s2">                retval = obj.data;
</span></span></span><span class="line"><span class="cl"><span class="s2">            }).wait();
</span></span></span><span class="line"><span class="cl"><span class="s2">            return retval;
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">    });
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">messageFunc</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="n">message</span><span class="p">[</span><span class="s2">&#34;type&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;send&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="nb">print</span><span class="p">(</span><span class="sa">u</span><span class="s2">&#34;[*] </span><span class="si">{0}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;payload&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">       <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="c1"># 发送数据给js 此处的script是process.create_script后的变量script</span>
</span></span><span class="line"><span class="cl">       <span class="n">script</span><span class="o">.</span><span class="n">post</span><span class="p">({</span><span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="s2">&#34;0e8315152843b943563031945032e957&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">   <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">process</span> <span class="o">=</span> <span class="n">frida</span><span class="o">.</span><span class="n">get_usb_device</span><span class="p">()</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="s1">&#39;嘟嘟牛在线&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">jsCode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">messageFunc</span><span class="p">)</span> <span class="c1">#注册消息事件</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Run Script&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>效果如下</p>
<p><img src="/FridaPython-recv.png"
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="frida-rpc">frida RPC
</h2><p>RPC即远程调用</p>
<p>js代码中使用rpc.exports={</p>
<p>​	rpcfunc : jsfunc</p>
<p>};</p>
<p>导出rpc接口</p>
<p>python代码中使用script.exports_sync.rpcfunc()调用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: UTF-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">frida</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">jsCode</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Java.perform(function(){
</span></span></span><span class="line"><span class="cl"><span class="s2">        var RequestUtil = Java.use(&#39;com.dodonew.online.http.RequestUtil&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        RequestUtil.encodeDesMap.overload(&#39;java.lang.String&#39;, &#39;java.lang.String&#39;, &#39;java.lang.String&#39;).implementation = function(a, b, c){
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;data: &#39;, a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;desKey: &#39;, b);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;desIV: &#39;, c);
</span></span></span><span class="line"><span class="cl"><span class="s2">            var retval = this.encodeDesMap(a, b, c);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;retval: &#39;, retval);
</span></span></span><span class="line"><span class="cl"><span class="s2">            return retval;
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">        var Utils = Java.use(&#39;com.dodonew.online.util.Utils&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        Utils.md5.implementation = function(a){
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;MD5 string: &#39;, a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            var retval = this.md5(a);
</span></span></span><span class="line"><span class="cl"><span class="s2">            console.log(&#39;retval: &#39;, retval);
</span></span></span><span class="line"><span class="cl"><span class="s2">            return retval;
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">    });
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    //用于主动调用
</span></span></span><span class="line"><span class="cl"><span class="s2">    function test(data){
</span></span></span><span class="line"><span class="cl"><span class="s2">        var result = &#34;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Java.perform(function(){
</span></span></span><span class="line"><span class="cl"><span class="s2">            result = Java.use(&#39;com.dodonew.online.util.Utils&#39;).md5(data);
</span></span></span><span class="line"><span class="cl"><span class="s2">        });
</span></span></span><span class="line"><span class="cl"><span class="s2">        return result;
</span></span></span><span class="line"><span class="cl"><span class="s2">    }
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    //通过rpc.exports导出接口rpcFunc
</span></span></span><span class="line"><span class="cl"><span class="s2">    rpc.exports = {
</span></span></span><span class="line"><span class="cl"><span class="s2">        rpcfunc: test //rpc接口和js函数映射
</span></span></span><span class="line"><span class="cl"><span class="s2">    };
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 注意js导出的rpcFunc在python中的写法为rpc_func,即大写字母前使用下划线</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">frida</span><span class="o">.</span><span class="n">get_usb_device</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;device: &#34;</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pid</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s2">&#34;com.dodonew.online&#34;</span><span class="p">)</span>  <span class="c1"># 以挂起方式创建进程</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;pid: &#34;</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">process</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;process: &#34;</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">jsCode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>  <span class="c1"># 加载完脚本, 恢复进程运行</span>
</span></span><span class="line"><span class="cl"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 休眠1秒,防止app未加载完毕就主动调用</span>
</span></span><span class="line"><span class="cl"><span class="c1"># python主动调用rpc函数 通过script.exports_sync.rpcfunc()</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">exports_sync</span><span class="o">.</span><span class="n">rpcfunc</span><span class="p">(</span><span class="s1">&#39;equtype=ANDROID&amp;loginImei=Androidnull&amp;timeStamp=1626790668522&amp;userPwd=a12345678&amp;username=15968079477&amp;key=sdlkjsdljf0j2fsjk&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Run Script&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>效果如下</p>
<p><img src="/FridaPython-RPC.png"
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="frida-算法转发">frida 算法转发
</h2><p>有时我们可能想用其他语言实现rpc，但是其他语言不一定有frida的rpc库，我们可以把python作为中间层，用python开启一个服务，封装并提供接口,这样就可以让别的语言访问</p>
<p>首先需要两个库运行web服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pip install uvicorn
</span></span><span class="line"><span class="cl">pip install fastapi
</span></span></code></pre></td></tr></table>
</div>
</div><p>代码如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">frida</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uvicorn</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">fastapi</span>
</span></span><span class="line"><span class="cl"><span class="n">jsCode</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  function hookTest(username, passward){
</span></span></span><span class="line"><span class="cl"><span class="s2">    var result;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Java.perform(function(){
</span></span></span><span class="line"><span class="cl"><span class="s2">        var time = new Date().getTime();
</span></span></span><span class="line"><span class="cl"><span class="s2">        var signData = &#39;equtype=ANDROID&amp;loginImei=Android352689082129358&amp;timeStamp=&#39; +
</span></span></span><span class="line"><span class="cl"><span class="s2">            time + &#39;&amp;userPwd=&#39; + passward + &#39;&amp;username=&#39; + username + &#39;&amp;key=sdlkjsdljf0j2fsjk&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s2">        var Utils = Java.use(&#39;com.dodonew.online.util.Utils&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        var sign = Utils.md5(signData).toUpperCase();
</span></span></span><span class="line"><span class="cl"><span class="s2">        console.log(&#39;sign: &#39;, sign);
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        var encryptData = &#39;{&#34;equtype&#34;:&#34;ANDROID&#34;,&#34;loginImei&#34;:&#34;Android352689082129358&#34;,&#34;sign&#34;:&#34;&#39;+
</span></span></span><span class="line"><span class="cl"><span class="s2">            sign +&#39;&#34;,&#34;timeStamp&#34;:&#34;&#39;+ time +&#39;&#34;,&#34;userPwd&#34;:&#34;&#39; + passward + &#39;&#34;,&#34;username&#34;:&#34;&#39; + username + &#39;&#34;}&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s2">        var RequestUtil = Java.use(&#39;com.dodonew.online.http.RequestUtil&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        var Encrypt = RequestUtil.encodeDesMap(encryptData, &#39;65102933&#39;, &#39;32028092&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        console.log(&#39;Encrypt: &#39;, Encrypt);
</span></span></span><span class="line"><span class="cl"><span class="s2">        result = Encrypt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    });
</span></span></span><span class="line"><span class="cl"><span class="s2">    return result;
</span></span></span><span class="line"><span class="cl"><span class="s2">}
</span></span></span><span class="line"><span class="cl"><span class="s2">rpc.exports = {
</span></span></span><span class="line"><span class="cl"><span class="s2">    rpcfunc: hookTest
</span></span></span><span class="line"><span class="cl"><span class="s2">};
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">process</span> <span class="o">=</span> <span class="n">frida</span><span class="o">.</span><span class="n">get_device_manager</span><span class="p">()</span><span class="o">.</span><span class="n">add_remote_device</span><span class="p">(</span><span class="s1">&#39;192.168.189.179:27042&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="s2">&#34;嘟嘟牛在线&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">create_script</span><span class="p">(</span><span class="n">jsCode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[*] Running Script&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">script</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">cipherText</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">exports_sync</span><span class="o">.</span><span class="n">rpcfunc</span><span class="p">(</span><span class="s1">&#39;12345678901&#39;</span><span class="p">,</span> <span class="s1">&#39;a123456789&#39;</span><span class="p">)</span><span class="c1"># 测试脚本是否成功运行</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cipherText</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 开启web服务处理请求</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">fastapi</span><span class="o">.</span><span class="n">FastAPI</span><span class="p">()</span><span class="c1"># 创建FastAPI实例</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.get</span><span class="p">(</span><span class="s2">&#34;/get&#34;</span><span class="p">)</span><span class="c1"># 定义一个get请求的路由,收到get请求后执行下面的异步函数</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">getEchoApi</span><span class="p">(</span><span class="n">item_id</span><span class="p">,</span> <span class="n">item_user</span><span class="p">,</span> <span class="n">item_pass</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">exports_sync</span><span class="o">.</span><span class="n">rpcfunc</span><span class="p">(</span><span class="n">item_user</span><span class="p">,</span> <span class="n">item_pass</span><span class="p">)</span> <span class="c1"># 处理用户名和密码后返回结果</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;item_id&#34;</span><span class="p">:</span> <span class="n">item_id</span><span class="p">,</span> <span class="s2">&#34;item_retval&#34;</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span><span class="p">)</span><span class="c1">#使用uvicorn运行FastAPI引用,在8080端口监听等待http请求</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>效果如下</p>
<p>成功开启服务</p>
<p><img src="/p/fridastudy/FridaPython-PythonServer.png"
	width="1134"
	height="651"
	srcset="/p/fridastudy/FridaPython-PythonServer_hu_af996df8530d4007.png 480w, /p/fridastudy/FridaPython-PythonServer_hu_4070b02c34639c16.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="174"
		data-flex-basis="418px"
	
></p>
<p>发起正确的get请求即可收到返回结果</p>
<p><img src="/p/fridastudy/FridaPython-ServerGet.png"
	width="1893"
	height="277"
	srcset="/p/fridastudy/FridaPython-ServerGet_hu_fc411f5a74806eab.png 480w, /p/fridastudy/FridaPython-ServerGet_hu_69f44eca49f14dd7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="683"
		data-flex-basis="1640px"
	
></p>
<h1 id="九-frida逆向实战">九. Frida逆向实战
</h1><h2 id="过vpn检测">过vpn检测
</h2><p>课件 屿秋-检测代理和root.apk</p>
<p>可以发现弹出通知提示网络异常以及Toast提示安全证书异常</p>
<img src="Practice-网络代理检测.png" style="zoom:20%;" />
<p>我们可以通过hook Toast定位异常检测点</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">showStacks</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;====================StackTraceStart====================&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.util.Log&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="nx">getStackTraceString</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.Throwable&#34;</span><span class="p">).</span><span class="nx">$new</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;=====================StackTraceEnd=====================&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">toast</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.widget.Toast&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">toast</span><span class="p">.</span><span class="nx">show</span><span class="p">.</span><span class="nx">implementation</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">showStacks</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Toast.show: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Toast栈回溯信息如下</p>
<p><img src="/p/fridastudy/Practice-ToastStackTrace.png"
	width="1273"
	height="785"
	srcset="/p/fridastudy/Practice-ToastStackTrace_hu_e1df9c10d9035092.png 480w, /p/fridastudy/Practice-ToastStackTrace_hu_237768209b4ed0c9.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="162"
		data-flex-basis="389px"
	
></p>
<p>不难看出可能和以下两个类有关</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">com.jtxc.common.viewmodel.BaseViewModel.b
</span></span><span class="line"><span class="cl">com.jtxc.common.viewmodel.HomeViewModel$2.accept
</span></span></code></pre></td></tr></table>
</div>
</div><p>但jadx静态分析时无法发现这两个类,说明可能有加壳,查壳发现是腾讯加固</p>
<h2 id="破解极简记账vip">破解极简记账VIP
</h2><h1 id="十-frida-api">十. Frida API
</h1><h2 id="java-bridge">Java Bridge
</h2><p><a class="link" href="https://frida.re/docs/javascript-api/#java"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#java</a></p>
<ol>
<li>
<p>Java.androidVersion 返回Android版本</p>
</li>
<li>
<p>Java.enumerateLoadedClasses(callbacks)</p>
<p>遍历已经加载的类,callbacks如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">callbacks</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">onMatch</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">handle</span><span class="p">),</span> <span class="c1">//可用Java.cast()将handle转换为指定class
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">onComplete</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Java.enumerateClassLoaders(callbacks)</p>
<p>遍历java vm中的classloader,callback如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">classback</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">onMatch</span><span class="p">(</span><span class="nx">loader</span><span class="p">),</span> <span class="c1">//java.lang.ClassLoader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">onComplete</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Java.enumerateMethods(query)</p>
<p>查询匹配条件的方法</p>
<p>用法如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">groups</span><span class="o">=</span><span class="nx">Java</span><span class="p">.</span><span class="nx">enumerateMethods</span><span class="p">(</span><span class="s2">&#34;&lt;class&gt;!&lt;method&gt;/isu&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//such as query=&#34;*youtube*!on*/is&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">groups</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>支持通配符*用于关键字搜索</p>
<p>/后跟参数</p>
<p>i: 大小写不敏感</p>
<p>s: 包括方法签名信息</p>
<p>u: 忽略系统类</p>
</li>
<li>
<p>Java.perform(function)</p>
<p>确保在主线程中执行函数</p>
</li>
<li>
<p>Java.use(className)</p>
<p>获取Java类</p>
</li>
<li>
<p>Java.openClassFile(filePath)</p>
<p>打开.dex文件,返回类有load()和getClassNames()方法</p>
</li>
<li>
<p>Java.choose(className, callbacks)</p>
<p>遍历实例,callbacks={onMatch(instance),onComplete()}</p>
</li>
<li>
<p>Java.cast(handle, klass)</p>
<p>类型转换</p>
</li>
<li>
<p>Java.array(type, elements)</p>
<p>创建指定类型的数组</p>
</li>
<li>
<p>Java.vm 对象</p>
<p>getEnv()获取JNIEnv</p>
<p>perform(function)执行函数</p>
</li>
<li>
<p>Java.isMainThread()</p>
<p>检测是否运行在主线程</p>
</li>
</ol>
<h2 id="memory">Memory
</h2><p><a class="link" href="https://frida.re/docs/javascript-api/#memory"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#memory</a></p>
<ol>
<li>
<p>Memory.scan(address, size, pattern, callbacks)</p>
<p>在指定范围内扫描指定匹配串,callbacks{onMatch(address,size),onComplete()}</p>
</li>
<li>
<p>Memory.alloc(size[, options])</p>
<p>申请指定大小空间,返回NativePointer</p>
</li>
<li>
<p>Memory.copy(dst, src, n)</p>
</li>
<li>
<p>Memory.protect(address, size, protection)</p>
<p>修改内存保护属性</p>
</li>
</ol>
<h2 id="nativepointer">NativePointer
</h2><p><a class="link" href="https://frida.re/docs/javascript-api/#nativepointer"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#nativepointer</a></p>
<ol>
<li>
<p>new NativePointer(str)</p>
<p>创建指针指向str描述的地址处,可用简写形式ptr(str)</p>
</li>
<li>
<p>.isNull()</p>
<p>判断是否为空指针</p>
</li>
<li>
<p>add(rhs),sub(rhs),and(rhs),or(rhs),xor(rhs)</p>
<p>对NativePointer执行对应运算并返回新的NativePointer</p>
<p>rhs: 可以是数字或者NativePointer</p>
</li>
<li>
<p>shr(n),shl(n)</p>
<p>右移/左移指定bits</p>
</li>
<li>
<p>toString([radix = 16])</p>
<p>转换为指定进制字符串(默认hex)</p>
</li>
<li>
<p>readPointer()/writePointer(ptr)</p>
<p>向该指针指向的内存区域读/写一个指针</p>
</li>
<li>
<p><code>readS8()</code>, <code>readU8()</code>, <code>readS16()</code>, <code>readU16()</code>, <code>readS32()</code>, <code>readU32()</code>, <code>readShort()</code>, <code>readUShort()</code>, <code>readInt()</code>, <code>readUInt()</code>, <code>readFloat()</code>, <code>readDouble()</code>, <code>readS64()</code>, <code>readU64()</code>, <code>readLong()</code>, <code>readULong()</code></p>
<p>读取指定类型的数据</p>
</li>
<li>
<p><code>writeS8(value)</code>, <code>writeU8(value)</code>, <code>writeS16(value)</code>, <code>writeU16(value)</code>, <code>writeS32(value)</code>, <code>writeU32(value)</code>, <code>writeShort(value)</code>, <code>writeUShort(value)</code>, <code>writeInt(value)</code>, <code>writeUInt(value)</code>, <code>writeFloat(value)</code>, <code>writeDouble(value)</code>, <code>writeS64(value)</code>, <code>writeU64(value)</code>, <code>writeLong(value)</code>, <code>writeULong(value)</code></p>
<p>写入指定类型数据</p>
</li>
<li>
<p>readByteArray(length)/writeByteArray(bytes)</p>
<p>读/写字节数组</p>
</li>
<li>
<p><code>readCString([size = -1])</code>, <code>readUtf8String([size = -1])</code>, <code>readUtf16String([length = -1])</code></p>
<p>读取字节流并转换为ASCII/UTF-8/UTF-16字符串</p>
</li>
<li>
<p><code>writeUtf8String(str)</code>, <code>writeUtf16String(str)</code></p>
<p>写入字符串</p>
</li>
</ol>
<h2 id="module">Module
</h2><p><a class="link" href="https://frida.re/docs/javascript-api/#module"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#module</a></p>
<ol>
<li>
<p>enumerateImports(libname)</p>
</li>
<li>
<p>enumerateExports(libname)</p>
</li>
<li>
<p>enumerateSymbols(libname)</p>
</li>
<li>
<p>enumerateRanges(protection)</p>
</li>
<li>
<p>enumerateSections(libname)</p>
</li>
<li>
<p>enumerateDependencies(libname)</p>
</li>
<li>
<p>findExportByName(exportName)</p>
</li>
<li>
<p>getExportByName(exportName)</p>
</li>
<li>
<p>Module.load(path)</p>
<p>加载指定模块</p>
</li>
<li>
<p>Module.findBaseAddress(name)/Module.getBaseAddress(name)</p>
<p>未找到时,find返回null,get返回exception</p>
</li>
<li>
<p>Module.findExportByName(moduleName|null, exportName)</p>
<p>Module.getExportByName(moduleName|null, exportName)</p>
<p>返回指定模块导出函数的绝对地址</p>
</li>
</ol>
<h2 id="debug-symbol">Debug Symbol
</h2><h3 id="debugsymbolfromaddressaddressdebugsymbolfromnamename">DebugSymbol.fromAddress(address)/DebugSymbol.fromName(name)
</h3><p>官网: <a class="link" href="https://frida.re/docs/javascript-api/#debugsymbol"  target="_blank" rel="noopener"
    >DebugSymbol</a>
功能: 查找address/name对应的调试信息并作为对象返回
该对象包含:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">address</span>      <span class="c1">//该符号对应地址 作为NativePointer        
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">name</span>         <span class="c1">//符号名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">moudleName</span>   <span class="c1">//拥有该符号的模块名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fileName</span>     <span class="c1">//拥有该符号的文件名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">lineNumber</span>   <span class="c1">//行号
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="common-api">Common API
</h2><p><a class="link" href="https://frida.re/docs/javascript-api/#java"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#java</a></p>
<p><a class="link" href="https://frida.re/docs/javascript-api/#interceptor"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#interceptor</a></p>
<p><a class="link" href="https://frida.re/docs/javascript-api/#instruction"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#instruction</a></p>
<p><a class="link" href="https://frida.re/docs/javascript-api/#arm64writer"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#arm64writer</a></p>
<p><a class="link" href="https://frida.re/docs/javascript-api/#kernel"  target="_blank" rel="noopener"
    >https://frida.re/docs/javascript-api/#kernel</a></p>
<h2 id="table-of-api-contents">Table Of API Contents
</h2><ol>
<li>Runtime information
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#frida"  target="_blank" rel="noopener"
    >Frida</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#script"  target="_blank" rel="noopener"
    >Script</a></li>
</ol>
</li>
<li>Process, Thread, Module and Memory
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#thread"  target="_blank" rel="noopener"
    >Thread</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#process"  target="_blank" rel="noopener"
    >Process</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#module"  target="_blank" rel="noopener"
    >Module</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#modulemap"  target="_blank" rel="noopener"
    >ModuleMap</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#memory"  target="_blank" rel="noopener"
    >Memory</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#memoryaccessmonitor"  target="_blank" rel="noopener"
    >MemoryAccessMonitor</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#cmodule"  target="_blank" rel="noopener"
    >CModule</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#apiresolver"  target="_blank" rel="noopener"
    >ApiResolver</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#debugsymbol"  target="_blank" rel="noopener"
    >DebugSymbol</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#kernel"  target="_blank" rel="noopener"
    >Kernel</a></li>
</ol>
</li>
<li>Data Types, Function and Callback
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#int64"  target="_blank" rel="noopener"
    >Int64</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#uint64"  target="_blank" rel="noopener"
    >UInt64</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#nativepointer"  target="_blank" rel="noopener"
    >NativePointer</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#arraybuffer"  target="_blank" rel="noopener"
    >ArrayBuffer</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#nativefunction"  target="_blank" rel="noopener"
    >NativeFunction</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#nativecallback"  target="_blank" rel="noopener"
    >NativeCallback</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#systemfunction"  target="_blank" rel="noopener"
    >SystemFunction</a></li>
</ol>
</li>
<li>Network
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#socket"  target="_blank" rel="noopener"
    >Socket</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#socketlistener"  target="_blank" rel="noopener"
    >SocketListener</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#socketconnection"  target="_blank" rel="noopener"
    >SocketConnection</a></li>
</ol>
</li>
<li>File and Stream
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#file"  target="_blank" rel="noopener"
    >File</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#iostream"  target="_blank" rel="noopener"
    >IOStream</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#inputstream"  target="_blank" rel="noopener"
    >InputStream</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#outputstream"  target="_blank" rel="noopener"
    >OutputStream</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#unixinputstream"  target="_blank" rel="noopener"
    >UnixInputStream</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#unixoutputstream"  target="_blank" rel="noopener"
    >UnixOutputStream</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#win32inputstream"  target="_blank" rel="noopener"
    >Win32InputStream</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#win32outputstream"  target="_blank" rel="noopener"
    >Win32OutputStream</a></li>
</ol>
</li>
<li>Database
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#sqlitedatabase"  target="_blank" rel="noopener"
    >SqliteDatabase</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#sqlitestatement"  target="_blank" rel="noopener"
    >SqliteStatement</a></li>
</ol>
</li>
<li>Instrumentation
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#interceptor"  target="_blank" rel="noopener"
    >Interceptor</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#stalker"  target="_blank" rel="noopener"
    >Stalker</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#objc"  target="_blank" rel="noopener"
    >ObjC</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#java"  target="_blank" rel="noopener"
    >Java</a></li>
</ol>
</li>
<li>CPU Instruction
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#instruction"  target="_blank" rel="noopener"
    >Instruction</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#x86writer"  target="_blank" rel="noopener"
    >X86Writer</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#x86relocator"  target="_blank" rel="noopener"
    >X86Relocator</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#x86-enum-types"  target="_blank" rel="noopener"
    >x86 enum types</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#armwriter"  target="_blank" rel="noopener"
    >ArmWriter</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#armrelocator"  target="_blank" rel="noopener"
    >ArmRelocator</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#thumbwriter"  target="_blank" rel="noopener"
    >ThumbWriter</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#thumbrelocator"  target="_blank" rel="noopener"
    >ThumbRelocator</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#arm-enum-types"  target="_blank" rel="noopener"
    >ARM enum types</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#arm64writer"  target="_blank" rel="noopener"
    >Arm64Writer</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#arm64relocator"  target="_blank" rel="noopener"
    >Arm64Relocator</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#aarch64-enum-types"  target="_blank" rel="noopener"
    >AArch64 enum types</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#mipswriter"  target="_blank" rel="noopener"
    >MipsWriter</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#mipsrelocator"  target="_blank" rel="noopener"
    >MipsRelocator</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#mips-enum-types"  target="_blank" rel="noopener"
    >MIPS enum types</a></li>
</ol>
</li>
<li>Other
<ol>
<li><a class="link" href="https://frida.re/docs/javascript-api/#console"  target="_blank" rel="noopener"
    >Console</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#hexdump"  target="_blank" rel="noopener"
    >Hexdump</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#shorthand"  target="_blank" rel="noopener"
    >Shorthand</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#communication-between-host-and-injected-process"  target="_blank" rel="noopener"
    >Communication between host and injected process</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#timing-events"  target="_blank" rel="noopener"
    >Timing events</a></li>
<li><a class="link" href="https://frida.re/docs/javascript-api/#garbage-collection"  target="_blank" rel="noopener"
    >Garbage collection</a></li>
</ol>
</li>
</ol>
<h1 id="references">References
</h1><p><a class="link" href="https://github.com/DERE-ad2001/Frida-Labs"  target="_blank" rel="noopener"
    >Frida-Labs</a></p>
<p>零基础一站式安卓逆向2022</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/android%E4%BB%8E%E6%95%B4%E4%BD%93%E5%8A%A0%E5%9B%BA%E5%88%B0%E6%8A%BD%E5%8F%96%E5%8A%A0%E5%9B%BA%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8F%8A%E5%8E%9F%E7%90%86/">
        
        
            <div class="article-image">
                <img src="/p/android%E4%BB%8E%E6%95%B4%E4%BD%93%E5%8A%A0%E5%9B%BA%E5%88%B0%E6%8A%BD%E5%8F%96%E5%8A%A0%E5%9B%BA%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8F%8A%E5%8E%9F%E7%90%86/27-Apk%E5%90%88%E5%B9%B6%E5%9B%BE.46f2f51dac420eddd22372d9ad26e97c_hu_9ee9f24bdfd2b321.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Android从整体加固到抽取加固的实现及原理"
                        
                        data-hash="md5-RvL1HaxCDt3SI3LZrSbpfA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Android从整体加固到抽取加固的实现及原理</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/dex%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90-readdex%E8%A7%A3%E6%9E%90%E5%99%A8%E5%AE%9E%E7%8E%B0/">
        
        
            <div class="article-image">
                <img src="/p/dex%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90-readdex%E8%A7%A3%E6%9E%90%E5%99%A8%E5%AE%9E%E7%8E%B0/1-dex%E6%96%87%E4%BB%B6%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84.578be309c60b9810690dcc195717c187_hu_a4b169926d45edd6.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Dex文件结构解析 ReadDex解析器实现"
                        
                        data-hash="md5-V4vjCcYLmBBpDcwZVxfBhw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Dex文件结构解析 ReadDex解析器实现</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/elf%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E6%B5%85%E6%9E%90-%E8%A7%A3%E6%9E%90%E5%99%A8%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%AE%9E%E7%8E%B0/">
        
        
            <div class="article-image">
                <img src="/p/elf%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E6%B5%85%E6%9E%90-%E8%A7%A3%E6%9E%90%E5%99%A8%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%AE%9E%E7%8E%B0/1-%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F.fe2213b576eef45317998ee1c132656c_hu_fbc5ad0c4a06e52a.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post ELF文件结构浅析-解析器和加载器实现"
                        
                        data-hash="md5-/iITtXbu9FMXmY7hwTJlbA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">ELF文件结构浅析-解析器和加载器实现</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/androidbasicstudy/">
        
        
            <div class="article-image">
                <img src="/p/androidbasicstudy/8_%E6%B4%BB%E5%8A%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.b6d9e6ef6be71ee1bd6ad48f04fc0eb5_hu_b0bc600821d22529.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post AndroidBasicStudy"
                        
                        data-hash="md5-ttnm72vnHuG9atSPBPwOtQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">AndroidBasicStudy</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/ndkstudy/">
        
        

        <div class="article-details">
            <h2 class="article-title">NDKStudy</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="OrientalGlass/utterances-comments"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 OrientalGlass
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
